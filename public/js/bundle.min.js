async function cachePlaylist(){const pathname=window.location.pathname;if(!pathname.includes("/playlists/"))return;const cache=await caches.open("playlist-cache");if(navigator.onLine){const res=await fetch(pathname);await cache.put(pathname,res)}else window.addEventListener("onLine",async()=>{const registration=await navigator.serviceWorker.getRegistration();await registration.sync.register("sync-playlists")})}"serviceWorker"in navigator&&cachePlaylist();const copyBtn=document.getElementById("copy-button"),copyTxt=document.getElementById("copy-text"),playlistTxt=document.getElementById("playlist-name-text"),playlistCode=document.querySelector(".playlist-name");if(playlistCode&&playlistTxt){const createCopyElement=(button,textEl,type)=>{button.addEventListener("click",()=>{console.log("clicked");let resetText=button.innerHTML;textEl.focus(),textEl.select(),textEl.setSelectionRange(0,99999);try{const msg=document.execCommand("copy")?"successful":"unsuccessful";console.log("Copying text command was "+msg),button.innerHTML="Copied "+type,setTimeout(()=>{button.innerHTML=resetText},3e3)}catch(err){console.log("Oops, unable to copy",err),button.innerHTML="Please retry"}})};copyBtn&&copyTxt&&createCopyElement(copyBtn,copyTxt,"URL"),createCopyElement(playlistCode,playlistTxt,"Code")}const firebaseConfig={apiKey:"AIzaSyDnBaT31_LbWAjiRd7isQ1pPdiDVD1HmtQ",authDomain:"combinify-b1222.firebaseapp.com",databaseURL:"combinify-b1222-default-rtdb.europe-west1.firebasedatabase.app",projectId:"combinify-b1222",storageBucket:"combinify-b1222.appspot.com",messagingSenderId:"274350746286",appId:"1:274350746286:web:ee843bfbd1f420cb235b3f",measurementId:"G-1PDBZFE48J"};firebase.initializeApp(firebaseConfig);const socket=io();window.addEventListener("load",()=>{if(window.location.pathname.startsWith("/playlists")){const peopleEl=document.querySelector(".people"),playlist=document.querySelector(".playlist-name"),songContainer=document.querySelector(".songs"),songListEl=document.querySelector(".song-lists"),copyButton=document.getElementById("copy-button"),afterHashtag=/#([\w\d]+)/.exec(playlist.innerHTML)[1],beforeHashtag=/([\w\d\s]+)#/.exec(playlist.innerHTML)[1],currentUser=songContainer.classList[1],spotifyUrl=playlist.getAttribute("data-spotify-link"),playlistRef=firebase.database().ref("playlists/"+beforeHashtag),songsRef=playlistRef.child("/songs/");if(socket.on("update users",playlist=>{!function(playlist){peopleEl.innerHTML="",Object.values(playlist.activeUsers).forEach(user=>{const personEl=document.createElement("section");if(personEl.classList.add("person"),user.id===playlist.host){personEl.classList.add("host");const hostTag=document.createElement("div");hostTag.classList.add("host-tag"),personEl.appendChild(hostTag)}personEl.classList.add(user.id);const imgEl=document.createElement("img");imgEl.src=user.image;const nameEl=document.createElement("h2"),nameText=document.createTextNode(user.name);nameEl.classList.add("name"),nameEl.appendChild(nameText),personEl.appendChild(imgEl),personEl.appendChild(nameEl),peopleEl.appendChild(personEl)})}(playlist),document.querySelectorAll(".person").forEach(async person=>{const personId=person.classList[[person.classList.length-1]];person.addEventListener("click",async()=>{if(person.classList.contains("selected"))return;songListEl.innerHTML="";const containerOfSongs=document.createElement("section");containerOfSongs.classList.add("songs"),containerOfSongs.classList.add(""+personId),await setNewSongs(personId,containerOfSongs)})})}),socket.on("animate songs",async()=>{console.log("Animation fired"),document.querySelectorAll(".songs section").forEach((song,i)=>{song.classList.add("animateSong")}),copyButton||function(){console.log("In Btn!");const songListElement=document.querySelector(".song-lists"),btn=document.createElement("button"),btnNode=document.createTextNode("Spotify Link"),label=document.createElement("label"),textArea=document.createElement("textarea"),textNode=document.createTextNode(spotifyUrl);console.log("spotifyurl=",spotifyUrl),textArea.id="copy-text",textArea.appendChild(textNode),label.for="copy-text",label.appendChild(textArea),btn.id="copy-button",btn.classList.add("btn"),btn.appendChild(btnNode),songListElement.appendChild(label),songListElement.appendChild(btn)}()}),0!==songContainer.length){if(!songContainer.childNodes[1].classList)return;let isAnimating=songContainer.childNodes[1].classList.contains("animateSong");isAnimating&&socket.emit("add songs"),songContainer.innerHTML="",setNewSongs(currentUser,songContainer,isAnimating).then(()=>console.log("set songs")).catch(err=>console.log(err))}async function setNewSongs(personId,containerOfSongs,isAnimating){return await playlistRef.get().then(snap=>{if(snap.val().searchKey===afterHashtag)return songsRef.get().then(snap=>{Object.keys(snap.val()).forEach(async key=>{key===personId&&(snap.val()[""+key].forEach(song=>{const artistContainer=document.createElement("section");isAnimating&&artistContainer.classList.add("animateSong");const songEl=document.createElement("div"),artistEl=document.createElement("p"),nameEl=document.createElement("p");if(artistEl.classList.add("songArtist"),nameEl.classList.add("songName"),artistEl.innerHTML=""+song.songArtist,nameEl.innerHTML=""+song.songName,songEl.appendChild(nameEl),songEl.appendChild(artistEl),artistContainer.appendChild(songEl),personId===currentUser){const deleteBtn='\n                   <svg xmlns="http://www.w3.org/2000/svg" height="50" viewBox="0 0 24 24" width="50" class="delete">\n                    <path d="M0 0h24v24H0z" fill="none"/>\n                    <path d="M0 0h24v24H0V0z" fill="none"/>\n                    <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zm2.46-7.12l1.41-1.41L12 12.59l2.12-2.12 1.41 1.41L13.41 14l2.12 2.12-1.41 1.41L12 15.41l-2.12 2.12-1.41-1.41L10.59 14l-2.13-2.12zM15.5 4l-1-1h-5l-1 1H5v2h14V4z"/>\n                  </svg>\n                  ';artistContainer.innerHTML+=deleteBtn}containerOfSongs.appendChild(artistContainer)}),songListEl.appendChild(containerOfSongs),function(personId){const allPeople=document.querySelectorAll(".person");let classes=[];const selected=document.querySelector(".selected");selected&&selected.classList.remove("selected");allPeople.forEach(person=>{person.classList.contains(personId)&&(person.classList.forEach(cssClass=>{classes.push(cssClass)}),person.removeAttribute("class"),person.classList.add("selected"),classes.forEach(separateClass=>{person.classList.add(separateClass)}))})}(personId),await async function(){const deleteBtn=document.querySelectorAll(".delete");return await playlistRef.get().then(snap=>{snap.val().searchKey===afterHashtag&&deleteBtn.forEach(btn=>{btn.addEventListener("click",e=>{let songEl=e.currentTarget.previousSibling.previousSibling.childNodes,songArtist=songEl[1].innerHTML,songName=songEl[0].innerHTML;const songsRef=playlistRef.child("/songs/"+songContainer.classList[1]);return e.currentTarget.parentElement.innerHTML="",songsRef.get().then(snap=>{snap.forEach(snapshot=>{snapshot.val().songArtist===songArtist&&snapshot.val().songName===songName&&songsRef.orderByChild("uri").equalTo(snapshot.val().uri).once("value").then(snapshot=>{snapshot.forEach(child=>child.ref.remove().then(()=>"Removed song").catch(err=>console.warn("songErr",err)))}).catch(err=>console.warn("songRefErr",err))})}).catch(err=>console.warn("playlistRefErr",err))})})}).catch(err=>console.warn(err))}())})}).catch(err=>console.warn("SongErr",err))}).catch(err=>console.warn("playlistRefErr",err))}}});